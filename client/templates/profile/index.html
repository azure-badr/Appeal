<!DOCTYPE html>
<html>
  <head>
    <title>Ban Appeal</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico', _scheme='https') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='profile/index.css', _scheme='https') }}" />
  </head>
  <body>
    {% if user_ban_appeal_data is none %}
    <h1>Pakcord Ban Appeal</h1>
    <form class="form" action="/appeal" method="POST" onsubmit="onFormSubmit(event)">
      <label for="ban_reason">Why do you think you were banned?</label>
      <textarea id="ban_reason" name="ban_reason" minlength="10" maxlength="250" rows="2" required></textarea>
      <span class="required">required</span>

      <label for="reason">Why would you like to be unbanned?</label>
      <textarea id="reason" name="reason" minlength="10" maxlength="1500" rows="5" required></textarea>
      <span class="required">required</span>

      <input id="appeal-button" class="button" type="submit" value="Submit" />
    </form>
    {% else %}
      {% if user_ban_appeal_data.status == "accepted" %}
      <div class="container">
        <h1 class="status-text accepted">Your ban appeal has been <b>accepted</b>.</h1>
        <p class="status">Status: <span class="accepted">{{ user_ban_appeal_data.status }}</span></p>
        <p><b>You can now join the server again</b> ðŸŽ‰</p>
        <p>Join using the following link: </p> 
        <a class="link" target="_blank" href="https://discord.gg/pakcord">discord.gg/pakcord</a>
      </div>
      {% elif user_ban_appeal_data.status == "rejected" %}
      <div class="container">
        <h1 class="status-text rejected">Your ban appeal has been <b>rejected</b>.</h1>
        <p class="status">Status: <span class="rejected">{{ user_ban_appeal_data.status }}</span></p>
        {% if user_ban_appeal_data.permanent %}
          <p>This ban is <b>permanent</b></p>
        {% else %}
          <p>You can reappeal in <b>{{ reappeal_time }}</b></p>
        {% endif %}
      </div>
      {% else %}
      <div class="container">
        <h1 class="status-text review">Your ban appeal is currently being <b>reviewed</b>.</h1>
        <p class="status">Status: <span class="review">{{ user_ban_appeal_data.status }}</span></p>
        <p>We will review your appeal within a week. Keep checking for updates.</p> <br />
        <p style="opacity: 0.8; margin-top: 0;">Please note that refreshing the page is required for updates to take effect.</p>
      {% endif %}
      </div>
      <h1 class="reason">Reason you provided</h1>
      <p>{{ user_ban_appeal_data.reason }}</p>
    {% endif %}
    <a style="text-decoration: none;" href="{{ url_for('logout', _scheme='https') }}">
      <div class="button" style="max-width: fit-content; margin-top: 2rem;">
        Logout
      </div>
    </a>

    <script>
      function onFormSubmit(event) {
        event.preventDefault();
        
        const button = document.getElementById("appeal-button");

        button.disabled = true;
        button.value = "Sending appeal...";

        const form = event.target;
        const formData = new FormData(form);

        fetch("/appeal", {
          method: "POST",
          body: formData
        });
      }
    </script>
  </body>
</html>
